{% extends 'layouts/base-layout.html' %}
{% load static %}

{% block title_layout %}{{ articulo.titulo }} - Resistencia Viva{% endblock %}

{% block content_layout %}

<style>
    .btn-like {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 1.6rem;
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 0;
    }

    .heart {
        font-size: 1.8rem;
        transition: transform 0.2s ease;
    }

    .heart:hover {
        transform: scale(1.2);
    }

    .liked {
        color: red;
    }

    .like-count {
        font-size: 1.2rem;
        color: #555;
    }
</style>

<div class="container mt-4">
    

    <!-- Imagen principal -->
    <div class="row mb-4">
        <div class="col-12">
            {% if articulo.imagen %}
                <img src="{{ articulo.imagen.url }}" alt="{{ articulo.titulo }}" class="img-fluid rounded shadow">
            {% else %}
                <div class="bg-secondary text-white text-center p-5 rounded">
                    Sin imagen disponible
                </div>
            {% endif %}
        </div>
    </div>

    <!-- T√≠tulo + categor√≠a -->
    <div class="row mb-3">
        <div class="col-12">

            <div class="d-flex align-items-center mb-2">
                <div class="orange-strip-card"
                     style="width: 30px; height: 30px; background-color: var(--accent-orange); margin-right: 10px;">
                </div>
                <h2 class="m-0">{{ articulo.titulo }}</h2>
            </div>

            {% if articulo.categoria %}
                <span class="badge px-3 py-2"
                      style="background-color: {{ articulo.categoria.color }}; font-size: 0.9rem;">
                    {{ articulo.categoria.nombre }}
                </span>
            {% endif %}

            <p class="text-muted mt-2" style="font-size: 0.9rem;">
                Publicado el {{ articulo.fecha_publicacion|date:"d M Y" }}
            </p>

        </div>
    </div>

    
    <!-- Bot√≥n de Like -->
    <div class="mt-3">
        <form action="{% url 'post:like_articulo' articulo.slug %}" method="post">
            {% csrf_token %}
            <button type="submit" class="btn-like">
                {% if user.is_authenticated and user in articulo.likes.all %}
                    <span class="heart liked">‚ù§Ô∏è</span>
                {% else %}
                    <span class="heart">ü§ç</span>
                {% endif %}
                <span class="like-count">{{ articulo.total_likes }}</span>
            </button>
        </form>
    </div>

    <!-- Contenido -->
    <div class="row mb-5">
        <div class="col-12">
            <p style="font-size: 1.1rem; line-height: 1.7;">
                {{ articulo.contenido|linebreaks }}
            </p>
        </div>
    </div>

    <!-- Botones editar y eliminar -->
    {% if user.is_authenticated and user == articulo.autor or user.is_staff %}
    <div class="mt-4">
        <a href="{% url 'post:editar_articulo' articulo.slug %}" 
           class="btn btn-warning me-2">
            Editar
        </a>
        <a href="{% url 'post:eliminar_articulo' articulo.slug %}" 
           class="btn btn-danger">
            Eliminar
        </a>
    </div>
    {% endif %}

    <!-- Secci√≥n de comentarios -->
    <div class="row mt-5">
        <div class="col-12">

            <h4>Comentarios</h4>
            <hr>

            <!-- Lista de comentarios -->
            {% for comentario in comentarios %}
                <div class="mb-3 p-3 border rounded">
                    <strong>{{ comentario.usuario.username }}</strong>
                    <p class="mb-1">{{ comentario.contenido }}</p>
                    <small class="text-muted">{{ comentario.fecha|date:"d M Y H:i" }}</small>

                    {% include "post/comentario_recursivo.html" with comentario=comentario %}
                </div>
            {% endfor %}




            <!-- Formulario para comentar -->
            {% if user.is_authenticated %}
                <form method="post" class="mt-4">
                    {% csrf_token %}
                    {{ form.as_p }}
                    <button type="submit" class="btn btn-primary">Enviar comentario</button>
                </form>
            {% else %}
                <p class="mt-3">
                    <a href="{% url 'login' %}">Inicia sesi√≥n</a> para dejar un comentario.
                </p>
            {% endif %}

        </div>
    </div>

    <!-- Bot√≥n volver -->
    <div class="row mb-5">
        <div class="col-12">
            <a href="{% url 'core:index' %}" class="btn btn-dark px-4 py-2">
                ‚Üê Volver al inicio
            </a>
        </div>
    </div>

</div>

{% endblock content_layout %}